import mitt from"mitt";import{__extends,__assign,__awaiter,__generator}from"tslib";import{fabric}from"fabric";import ResizeObserver from"resize-observer-polyfill";import{debounce}from"lodash-es";import{v4}from"uuid";var Controls,Zoom$1,IconsInCanvas,DefinedEvents={TRIGGER_TOOL:"trigger_tool",CREATE_OBJ:"create_obj",DELETE_OBJ:"delete_obj",OBJECT_TYPE_IN_CANVAS_CHANGE:"object_type_in_canvas_change",UPDATE_CONTROLLER_BTN:"update_controller_btn"},EventEmitter=function(){Object.assign(this,mitt())};!function(Controls){Controls[Controls.Text=1]="Text",Controls[Controls.Circle=2]="Circle",Controls[Controls.WavyLine=3]="WavyLine",Controls[Controls.Seal=4]="Seal",Controls[Controls.Right=5]="Right",Controls[Controls.Wrong=6]="Wrong",Controls[Controls.NotCompleteRight=7]="NotCompleteRight",Controls[Controls.Zoom=8]="Zoom",Controls[Controls.Rotate=9]="Rotate",Controls[Controls.Flip=10]="Flip",Controls[Controls.Clean=11]="Clean"}(Controls||(Controls={})),function(Zoom){Zoom[Zoom.In=1]="In",Zoom[Zoom.Out=2]="Out"}(Zoom$1||(Zoom$1={})),function(IconsInCanvas){IconsInCanvas[IconsInCanvas.EncourageOfSeal=1]="EncourageOfSeal",IconsInCanvas[IconsInCanvas.ExcellentOfSeal=2]="ExcellentOfSeal",IconsInCanvas[IconsInCanvas.PerfectOfSeal=3]="PerfectOfSeal",IconsInCanvas[IconsInCanvas.UncorrectOfSeal=4]="UncorrectOfSeal",IconsInCanvas[IconsInCanvas.GreatOfSeal=5]="GreatOfSeal",IconsInCanvas[IconsInCanvas.NotCompleteRight=6]="NotCompleteRight",IconsInCanvas[IconsInCanvas.Right=7]="Right",IconsInCanvas[IconsInCanvas.Wrong=8]="Wrong"}(IconsInCanvas||(IconsInCanvas={}));var emiter=mitt();var ActionBase=function(_super){function ActionBase(correctId,type,canvas,isKeep){void 0===isKeep&&(isKeep=!0);var _this=_super.call(this)||this;return Object.defineProperty(_this,"isKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"isOn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"triggerParams",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"correctId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this.correctId=correctId,_this._type=type,_this.canvas=canvas,_this.isKeep=isKeep,emiter.on("".concat(_this.correctId,":").concat(DefinedEvents.TRIGGER_TOOL),_this.trigger.bind(_this)),_this}return __extends(ActionBase,_super),Object.defineProperty(ActionBase.prototype,"trigger",{enumerable:!1,configurable:!0,writable:!0,value:function(stateObj){stateObj.actionType===this._type?(this.triggerParams=stateObj.params,this._handleOn()):![Controls.Seal,Controls.Zoom,Controls.Rotate,Controls.Clean].includes(stateObj.actionType)&&this._handleOff()}}),Object.defineProperty(ActionBase.prototype,"_handleOn",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isOn=!0}}),Object.defineProperty(ActionBase.prototype,"_handleOff",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isOn=!1}}),Object.defineProperty(ActionBase.prototype,"addListener",{enumerable:!1,configurable:!0,writable:!0,value:function(obj){var _this=this;obj.on("added",(function(){emiter.emit("".concat(_this.correctId,":").concat(DefinedEvents.CREATE_OBJ))})),obj.on("removed",(function(){emiter.emit("".concat(_this.correctId,":").concat(DefinedEvents.DELETE_OBJ))}))}}),Object.defineProperty(ActionBase.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){emiter.off("".concat(this.correctId,":").concat(DefinedEvents.TRIGGER_TOOL),this.trigger)}}),Object.defineProperty(ActionBase.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),ActionBase}(EventEmitter),DefaultConfig$1={opacity:.5,fill:"transparent",stroke:"rgb(255, 0, 0)",strokeWidth:2},Ellipse=function(_super){function Ellipse(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_curEllipse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_downPointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=__assign(__assign({},DefaultConfig$1),config),_this}return __extends(Ellipse,_super),Object.defineProperty(Ellipse.prototype,"_create",{enumerable:!1,configurable:!0,writable:!0,value:function(param){var ellipse=new fabric.Ellipse(__assign(__assign({},this._config),param));return ellipse.__actionType=this._type,this.addListener(ellipse),this.canvas.add(ellipse),ellipse}}),Object.defineProperty(Ellipse.prototype,"mousedown",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&(this._downPointer=pointer,this._curEllipse=this._create({top:pointer.y,left:pointer.x}),this.canvas.selection=!1,this.canvas.skipTargetFind=!0)}}),Object.defineProperty(Ellipse.prototype,"mousemove",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){if(this.isOn&&this._curEllipse){var rx=Math.abs(this._downPointer.x-pointer.x)/2,ry=Math.abs(this._downPointer.y-pointer.y)/2;this._curEllipse.set({rx:rx,ry:ry,top:pointer.y>this._downPointer.y?this._downPointer.y:this._downPointer.y-2*ry,left:pointer.x>this._downPointer.x?this._downPointer.x:this._downPointer.x-2*rx}),this.canvas.requestRenderAll()}}}),Object.defineProperty(Ellipse.prototype,"mouseup",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&this._curEllipse&&(JSON.stringify(this._downPointer)===JSON.stringify(pointer)?this.canvas.remove(this._curEllipse):(this._curEllipse.set("opacity",1),this.canvas.setActiveObject(this._curEllipse)),this.canvas.selection=!0,this.canvas.skipTargetFind=!1,this.canvas.requestRenderAll(),this._curEllipse=null)}}),Object.defineProperty(Ellipse.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Ellipse}(ActionBase);function loadImage(url){return new Promise((function(resolve,reject){fabric.Image.fromURL(url,(function(img,isError){isError?reject(isError):resolve(img)}),{crossOrigin:"anonymous"})}))}var iconsLoaded={};function preloadIcon(iconMapBeforeLoad){return __awaiter(this,void 0,void 0,(function(){var loadQueen,iconArr,_loop_1,_i,iconArr_1,_a;return __generator(this,(function(_b){for(loadQueen=[],iconArr=Object.entries(iconMapBeforeLoad),_loop_1=function(iconName,iconUrl){iconsLoaded[iconName]||loadQueen.push(loadImage(iconUrl).then((function(img){iconsLoaded[iconName]=img})).catch((function(err){throw new Error(err)})))},_i=0,iconArr_1=iconArr;_i<iconArr_1.length;_i++)_loop_1((_a=iconArr_1[_i])[0],_a[1]);return 0===loadQueen.length?[2,Promise.resolve({success:!0})]:[2,Promise.all(loadQueen).then((function(res){return{success:!0}})).catch((function(err){return{success:!1}}))]}))}))}var Seal=function(_super){function Seal(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas,!1)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this}return __extends(Seal,_super),Object.defineProperty(Seal.prototype,"_handleOn",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._createImage()}}),Object.defineProperty(Seal.prototype,"_createImage",{enumerable:!1,configurable:!0,writable:!0,value:function(){iconsLoaded[this.triggerParams.insertIconType].clone(this._onClone.bind(this))}}),Object.defineProperty(Seal.prototype,"_onClone",{enumerable:!1,configurable:!0,writable:!0,value:function(img){img.set({top:40+.6*img.height/2,left:this.canvas.canvasOriginalWidth-40-.6*img.width/2,originX:"center",originY:"center",scaleX:.6,scaleY:.6,angle:-15}),img.setControlsVisibility({mb:!1,mt:!1,mr:!1,ml:!1}),img.__actionType=this._type,this.addListener(img),this.canvas.add(img)}}),Object.defineProperty(Seal.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Seal}(ActionBase),Text=function(_super){function Text(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_curText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this}return __extends(Text,_super),Object.defineProperty(Text.prototype,"_create",{enumerable:!1,configurable:!0,writable:!0,value:function(param){var text=new fabric.IText("",__assign(__assign({editable:!0,fontSize:16,originY:"center",fill:"red",padding:10,hiddenTextareaContainer:this.canvas.isFullscreen?this.canvas.wrapperEl.parentNode:null},param),this._config));text.__actionType=this._type,this.addListener(text),this.canvas.add(text),this.canvas.setActiveObject(text),text.enterEditing(),this._curText=text}}),Object.defineProperty(Text.prototype,"_handleOff",{enumerable:!1,configurable:!0,writable:!0,value:function(){_super.prototype._handleOff.call(this),this._curText&&this._removeEmptyText(),this._curText=null}}),Object.defineProperty(Text.prototype,"mousedown",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&(this._curText?(this._removeEmptyText(),this._curText=null):this._create({top:pointer.y,left:pointer.x}))}}),Object.defineProperty(Text.prototype,"_removeEmptyText",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._curText&&0===this._curText.text.length&&this.canvas.remove(this._curText)}}),Object.defineProperty(Text.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Text}(ActionBase),DefaultConfig={rang:4,strokeWidth:2,minPeriod:20},Wavyline=function(_super){function Wavyline(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_curLine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_downPointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=__assign(__assign({},DefaultConfig),config),_this}return __extends(Wavyline,_super),Object.defineProperty(Wavyline.prototype,"mousedown",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&(this._downPointer=pointer,this.canvas.selection=!1,this.canvas.skipTargetFind=!0)}}),Object.defineProperty(Wavyline.prototype,"mousemove",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&this._downPointer&&(this._downPointer.eq(pointer)||(this._curLine&&this.canvas.remove(this._curLine),this._draw(pointer),this.canvas.requestRenderAll()))}}),Object.defineProperty(Wavyline.prototype,"mouseup",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this.isOn&&this._downPointer&&(this._downPointer.eq(pointer)?this._curLine&&this.canvas.remove(this._curLine):(this._curLine.set("opacity",1),this.canvas.setActiveObject(this._curLine)),this.canvas.selection=!0,this.canvas.skipTargetFind=!1,this.canvas.requestRenderAll(),this._curLine=null,this._downPointer=null)}}),Object.defineProperty(Wavyline.prototype,"_draw",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){for(var _a=this._caculatePeriodAndNumByDistance(this._downPointer,pointer),period=_a.period,num=_a.num,pathData="M ".concat(this._downPointer.x," ").concat(this._downPointer.y),i=0;i<num;i++){var baseStartPointerX=this._downPointer.x+i*period;pathData+=0==i?" C ".concat(baseStartPointerX+period/8," ").concat(this._downPointer.y+this._config.rang,", ").concat(baseStartPointerX+3*period/8," ").concat(this._downPointer.y+this._config.rang,", ").concat(baseStartPointerX+period/2," ").concat(this._downPointer.y):" S ".concat(baseStartPointerX+3*period/8," ").concat(this._downPointer.y+this._config.rang,", ").concat(baseStartPointerX+period/2," ").concat(this._downPointer.y),pathData+=" S ".concat(baseStartPointerX+7*period/8," ").concat(this._downPointer.y-this._config.rang,", ").concat(baseStartPointerX+period," ").concat(this._downPointer.y)}var cPointer=new fabric.Point(this._downPointer.x+10,this._downPointer.y),angle=fabric.util.getBisector(this._downPointer,cPointer,pointer).angle,lineAngle=fabric.util.radiansToDegrees(angle);this._curLine=this._create(pathData,this._downPointer.y<pointer.y?lineAngle:-lineAngle)}}),Object.defineProperty(Wavyline.prototype,"_caculatePeriodAndNumByDistance",{enumerable:!1,configurable:!0,writable:!0,value:function(startPoint,endPoint){var distance=startPoint.distanceFrom(endPoint),period=this._config.minPeriod,num=Math.floor(distance/period);return distance%this._config.minPeriod!=0&&(period=distance/++num),{period:period,num:num}}}),Object.defineProperty(Wavyline.prototype,"_create",{enumerable:!1,configurable:!0,writable:!0,value:function(pathData,angle){var line=new fabric.Path(pathData,{fill:"transparent",stroke:"red",originX:"left",originY:"center",strokeWidth:this._config.strokeWidth,angle:angle});return line.__actionType=this._type,this.addListener(line),this.canvas.add(line),line}}),Object.defineProperty(Wavyline.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Wavyline}(ActionBase),CorrectingBase=function(_super){function CorrectingBase(correctId,type,canvas){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_loadedIcon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this}return __extends(CorrectingBase,_super),Object.defineProperty(CorrectingBase.prototype,"_onClone",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer,img){img.set({top:pointer.y,left:pointer.x,originX:"center",originY:"center"}),img.__actionType=this._type,this.addListener(img),this.canvas.add(img)}}),Object.defineProperty(CorrectingBase.prototype,"mousedown",{enumerable:!1,configurable:!0,writable:!0,value:function(pointer){this._loadedIcon.clone(this._onClone.bind(this,pointer))}}),Object.defineProperty(CorrectingBase.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._loadedIcon=null}}),CorrectingBase}(ActionBase),NotCompleteRight=function(_super){function NotCompleteRight(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this._loadedIcon=iconsLoaded[IconsInCanvas.NotCompleteRight],_this}return __extends(NotCompleteRight,_super),Object.defineProperty(NotCompleteRight.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),NotCompleteRight}(CorrectingBase),Right=function(_super){function Right(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this._loadedIcon=iconsLoaded[IconsInCanvas.Right],_this}return __extends(Right,_super),Object.defineProperty(Right.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Right}(CorrectingBase),Wrong=function(_super){function Wrong(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this._loadedIcon=iconsLoaded[IconsInCanvas.Wrong],_this}return __extends(Wrong,_super),Object.defineProperty(Wrong.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Wrong}(CorrectingBase),Zoom=function(_super){function Zoom(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas,!1)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"OUT_MAX",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(_this,"ZOOM_STEP",{enumerable:!0,configurable:!0,writable:!0,value:.1}),_this._config=config,_this}return __extends(Zoom,_super),Object.defineProperty(Zoom.prototype,"_handleOn",{enumerable:!1,configurable:!0,writable:!0,value:function(){switch(this.triggerParams.type){case Zoom$1.In:this._zoomIn();break;case Zoom$1.Out:this._zoomOut()}}}),Object.defineProperty(Zoom.prototype,"_zoomIn",{enumerable:!1,configurable:!0,writable:!0,value:function(){var canvasZoom=this.canvas.getZoom();this.canvas.setZoom(canvasZoom+this.ZOOM_STEP)}}),Object.defineProperty(Zoom.prototype,"_zoomOut",{enumerable:!1,configurable:!0,writable:!0,value:function(){var canvasZoom=this.canvas.getZoom();canvasZoom-this.ZOOM_STEP>=this.OUT_MAX&&this.canvas.setZoom(canvasZoom-this.ZOOM_STEP)}}),Object.defineProperty(Zoom.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Zoom}(ActionBase),Rotate=function(_super){function Rotate(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas,!1)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"ROTATE_STEP",{enumerable:!0,configurable:!0,writable:!0,value:90}),Object.defineProperty(_this,"_curRotate",{enumerable:!0,configurable:!0,writable:!0,value:0}),_this._config=config,_this}return __extends(Rotate,_super),Object.defineProperty(Rotate.prototype,"_handleOn",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._rotate()}}),Object.defineProperty(Rotate.prototype,"_rotate",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._curRotate=this._curRotate+this.ROTATE_STEP===360?0:this._curRotate+this.ROTATE_STEP,this.canvas.updateBackgroundImageRotate(this._curRotate)}}),Object.defineProperty(Rotate.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Rotate}(ActionBase),Flip=function(_super){function Flip(correctId,type,canvas,config){var _this=_super.call(this,correctId,type,canvas,!1)||this;return Object.defineProperty(_this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._config=config,_this}return __extends(Flip,_super),Object.defineProperty(Flip.prototype,"_handleOn",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._Flip()}}),Object.defineProperty(Flip.prototype,"_Flip",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.canvas.updateBackgroundImageFlip()}}),Object.defineProperty(Flip.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Flip}(ActionBase),ActionsManager=function(){function ActionsManager(correctId,canvas){Object.defineProperty(this,"_curActionType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_curTool",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tools",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_objs",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_correctId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._canvas=canvas,this._correctId=correctId}return Object.defineProperty(ActionsManager.prototype,"_handleActionTypeChange",{enumerable:!1,configurable:!0,writable:!0,value:function(actionInfo){var tool,actionType=actionInfo.actionType;switch(actionType){case Controls.Text:tool=this._curTool=this._createTool(actionType,Text);break;case Controls.Circle:tool=this._curTool=this._createTool(actionType,Ellipse);break;case Controls.WavyLine:tool=this._curTool=this._createTool(actionType,Wavyline);break;case Controls.Seal:tool=this._createTool(actionType,Seal);break;case Controls.Right:tool=this._curTool=this._createTool(actionType,Right);break;case Controls.Wrong:tool=this._curTool=this._createTool(actionType,Wrong);break;case Controls.NotCompleteRight:tool=this._curTool=this._createTool(actionType,NotCompleteRight);break;case Controls.Zoom:tool=this._createTool(actionType,Zoom);break;case Controls.Rotate:tool=this._createTool(actionType,Rotate);break;case Controls.Flip:tool=this._createTool(actionType,Flip);break;case Controls.Clean:this._clear()}tool&&emiter.emit("".concat(this._correctId,":").concat(DefinedEvents.TRIGGER_TOOL),__assign(__assign({},actionInfo),{isKeep:tool.isKeep}))}}),Object.defineProperty(ActionsManager.prototype,"_createTool",{enumerable:!1,configurable:!0,writable:!0,value:function(type,defClass){var tool=this._tools[type];return tool||(tool=this._tools[type]=new defClass(this._correctId,type,this._canvas)),tool}}),Object.defineProperty(ActionsManager.prototype,"_clear",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _a,objects=this._canvas.getObjects();(_a=this._canvas).remove.apply(_a,objects)}}),Object.defineProperty(ActionsManager.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){Object.values(this._tools).forEach((function(tool){tool.destroy()}))}}),Object.defineProperty(ActionsManager.prototype,"setCurActionType",{enumerable:!1,configurable:!0,writable:!0,value:function(actionInfo){null!==actionInfo&&null!=actionInfo?actionInfo.isKeep?(this._curActionType!==actionInfo.actionType&&this._handleActionTypeChange(actionInfo),this._curActionType=actionInfo.actionType):this._handleActionTypeChange(actionInfo):this._curActionType=null}}),Object.defineProperty(ActionsManager.prototype,"curActionType",{get:function(){return this._curActionType},enumerable:!1,configurable:!0}),Object.defineProperty(ActionsManager.prototype,"curTool",{get:function(){return this._curTool},enumerable:!1,configurable:!0}),ActionsManager}();function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var CanvasWithImage=function(_super){function CanvasWithImage(canvasEle,options,correctId,config){var _this=_super.call(this,canvasEle,options)||this;Object.defineProperty(_this,"_bgImageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_loadedBgImage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_canvasOriginalWidth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_canvasOriginalHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_originalContainerWidth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_originalContainerHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_currentContainerWidth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_currentContainerHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"minZoomValue",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(_this,"_bgImageRotate",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(_this,"_filpX",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_filpY",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_correctId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_isFullscreen",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_resizeObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var container=config.container,originalContainerWidth=config.originalContainerWidth,originalContainerHeight=config.originalContainerHeight;_this._bgImageUrl=config.imageUrl,_this._container=container,_this._correctId=correctId,_this._originalContainerWidth=_this._currentContainerWidth=originalContainerWidth,_this._originalContainerHeight=_this._currentContainerHeight=originalContainerHeight;var containerResize=debounce(_this._onContainerResize.bind(_this),100);return _this._resizeObserver||(_this._resizeObserver=new ResizeObserver((function(entries,observer){for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var entry=entries_1[_i],borderBoxSize=entry.borderBoxSize,contentBoxSize=entry.contentBoxSize,contentRect=entry.contentRect,_a=(null==borderBoxSize?void 0:borderBoxSize.length)>0?borderBoxSize[0]:(null==contentBoxSize?void 0:contentBoxSize.length)>0?contentBoxSize[0]:0,width=_a.inlineSize,height=_a.blockSize,tempWidth=void 0===width?contentRect.width:width,tempHeight=void 0===height?contentRect.height:height;_this._currentContainerWidth===tempWidth&&_this._currentContainerHeight===tempHeight||containerResize(tempWidth,tempHeight)}}))),canvasEle.parentNode&&(canvasEle.parentNode.style.margin="auto 0"),_this._initialize().then((function(){var _a;null===(_a=_this._resizeObserver)||void 0===_a||_a.observe(_this._container)})),_this}return __extends(CanvasWithImage,_super),Object.defineProperty(CanvasWithImage.prototype,"_initialize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return __awaiter(this,void 0,void 0,(function(){var loadingImg,_a;return __generator(this,(function(_b){switch(_b.label){case 0:return this.selection=!1,loadingImg=this._createLoadingEle(),_a=this,[4,loadImage(this._bgImageUrl)];case 1:return _a._loadedBgImage=_b.sent(),this.backgroundImage=this._loadedBgImage,this._container.removeChild(loadingImg),this._initializeOriginalCanvasSize(),this._update(),[2]}}))}))}}),Object.defineProperty(CanvasWithImage.prototype,"_createLoadingEle",{enumerable:!1,configurable:!0,writable:!0,value:function(){var imgEle=document.createElement("img");return imgEle.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MCAyMCI+CiAgPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iOCIgc3Ryb2tlPSIjMzI2MkZEIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiIHN0cm9rZS1kYXNoYXJyYXk9IjI2IDE0Ij4KICAgIDxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgYXR0cmlidXRlVHlwZT0iWE1MIiB0eXBlPSJyb3RhdGUiIGR1cj0iMXMiIGZyb209IjAgMTAgMTAiIHRvPSIzNjAgMTAgMTAiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPgogIDwvY2lyY2xlPgogIDx0ZXh0IHg9IjI1IiB5PSIxMCIgZHk9Ii40ZW0iIHRleHQtYW5jaG9yPSJzdGFydCIgZm9udC1zaXplPSIxNnB4IiBmb250LXdlaWdodD0nYm9sZCc+5Yqg6L295LitPC90ZXh0Pgo8L3N2Zz4K",imgEle.width=120,imgEle.height=20,imgEle.style.cssText="position: absolute;top: 50%;left: 50%;margin-left: -60px;margin-top: -10px;",this._container.appendChild(imgEle),imgEle}}),Object.defineProperty(CanvasWithImage.prototype,"_initializeOriginalCanvasSize",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _a=this._calculateImageSizeByRotate(),imgWidth=_a.width,imgHeight=_a.height,_b=this._calculateCanvasSizeByImageRate(imgWidth/imgHeight,this._originalContainerWidth,this._originalContainerHeight),canvasWidth=_b.width,canvasHeight=_b.height;this._canvasOriginalWidth=canvasWidth,this._canvasOriginalHeight=canvasHeight;var curCanvasWidth=this._calculateCanvasSizeByImageRate(imgWidth/imgHeight).width;this.minZoomValue=curCanvasWidth>canvasWidth?curCanvasWidth/this._canvasOriginalWidth:1}}),Object.defineProperty(CanvasWithImage.prototype,"_onContainerResize",{enumerable:!1,configurable:!0,writable:!0,value:function(width,height){this._currentContainerWidth=width,this._currentContainerHeight=height;var originalCanvasWidth=this.getWidth(),originalCanvasHeight=this.getHeight(),changeZoom=this.getZoom()-this.minZoomValue,canvasWidth=this._calculateCanvasSizeByImageRate(originalCanvasWidth/originalCanvasHeight).width;this.minZoomValue=canvasWidth>this._canvasOriginalWidth?canvasWidth/this._canvasOriginalWidth:1,this.setZoom(this.minZoomValue+changeZoom)}}),Object.defineProperty(CanvasWithImage.prototype,"updateBackgroundImageRotate",{enumerable:!1,configurable:!0,writable:!0,value:function(rotate){return void 0===rotate&&(rotate=0),__awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return this._bgImageRotate=rotate,this._loadedBgImage.set({angle:rotate}),this._initializeOriginalCanvasSize(),this.getZoom()!=this.minZoomValue&&this.setZoom(this.minZoomValue),setTimeout((function(){_this._update()}),0),[2]}))}))}}),Object.defineProperty(CanvasWithImage.prototype,"updateBackgroundImageFlip",{enumerable:!1,configurable:!0,writable:!0,value:function(){return __awaiter(this,void 0,void 0,(function(){var flipY,flipX,_this=this;return __generator(this,(function(_a){return 90===this._bgImageRotate||270===this._bgImageRotate?(flipY="object"===_typeof(this.backgroundImage)&&!!this.backgroundImage.flipY,this._filpY=!flipY):(flipX="object"===_typeof(this.backgroundImage)&&!!this.backgroundImage.flipX,this._filpX=!flipX),setTimeout((function(){_this._update()}),0),[2]}))}))}}),Object.defineProperty(CanvasWithImage.prototype,"updateBackgroundImage",{enumerable:!1,configurable:!0,writable:!0,value:function(imageUrl){return __awaiter(this,void 0,void 0,(function(){var _a;return __generator(this,(function(_b){switch(_b.label){case 0:return this._bgImageUrl=imageUrl,_a=this,[4,loadImage(this._bgImageUrl)];case 1:return _a._loadedBgImage=_b.sent(),this.backgroundImage=this._loadedBgImage,this._update(),[2]}}))}))}}),Object.defineProperty(CanvasWithImage.prototype,"_update",{enumerable:!1,configurable:!0,writable:!0,value:function(){var zoom=this.getZoom(),_a=this._calculateImageSizeByRotate(),imgWidth=_a.width,imgHeight=_a.height,_b=this._calculateCanvasSizeByImageRate(imgWidth/imgHeight),canvasHeight=_b.height;this.setWidth(_b.width+(zoom-this.minZoomValue)*this._canvasOriginalWidth),this.setHeight(canvasHeight+(zoom-this.minZoomValue)*this._canvasOriginalHeight),this._loadedBgImage.set({top:this._canvasOriginalHeight/2,left:this._canvasOriginalWidth/2,scaleX:this._canvasOriginalWidth/imgWidth,scaleY:this._canvasOriginalHeight/imgHeight,originX:"center",originY:"center",flipX:this._filpX,flipY:this._filpY})}}),Object.defineProperty(CanvasWithImage.prototype,"_calculateImageSizeByRotate",{enumerable:!1,configurable:!0,writable:!0,value:function(){var imgWidth=this._loadedBgImage.width,imgHeight=this._loadedBgImage.height;if(this._bgImageRotate/90%2!=0){var tempWidth=imgWidth;imgWidth=imgHeight,imgHeight=tempWidth}return{width:imgWidth,height:imgHeight}}}),Object.defineProperty(CanvasWithImage.prototype,"_calculateCanvasSizeByImageRate",{enumerable:!1,configurable:!0,writable:!0,value:function(rate,containerWidth,containerHeight){var canvasHeight,canvasWidth,tempContainerWidth=containerWidth||this._currentContainerWidth,tempContainerHeight=containerHeight||this._currentContainerHeight;return rate>tempContainerWidth/tempContainerHeight?(canvasWidth=tempContainerWidth,canvasHeight=tempContainerWidth/rate):(canvasHeight=tempContainerHeight,canvasWidth=rate*tempContainerHeight),{width:canvasWidth,height:canvasHeight}}}),Object.defineProperty(CanvasWithImage.prototype,"generateImage",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(0===this.getObjects().length)return null;for(var canvasWidth=this.getWidth(),canvasHeight=this.getHeight(),arr=this.toDataURL({format:"jpeg",left:0,top:0,width:canvasWidth,height:canvasHeight,multiplier:canvasWidth>1e3?1:2}).split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);n--;)u8arr[n]=bstr.charCodeAt(n);return new File([u8arr],this._correctId,{type:mime})}}),Object.defineProperty(CanvasWithImage.prototype,"setZoom",{enumerable:!1,configurable:!0,writable:!0,value:function(_value){return _super.prototype.setZoom.call(this,_value<this.minZoomValue?this.minZoomValue:_value),this._update(),this}}),Object.defineProperty(CanvasWithImage.prototype,"resetFilpRotate",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _this=this;this._filpY=!1,this._filpX=!1,this._bgImageRotate=0,setTimeout((function(){_this._update()}),0)}}),Object.defineProperty(CanvasWithImage.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._resizeObserver.unobserve(this._container),this._resizeObserver=null}}),Object.defineProperty(CanvasWithImage.prototype,"bgImageUrl",{get:function(){return this._bgImageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasWithImage.prototype,"canvasOriginalWidth",{get:function(){return this._canvasOriginalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasWithImage.prototype,"canvasOriginalHeight",{get:function(){return this._canvasOriginalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasWithImage.prototype,"originalContainerWidth",{get:function(){return this._originalContainerWidth},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasWithImage.prototype,"originalContainerHeight",{get:function(){return this._originalContainerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasWithImage.prototype,"isFullscreen",{get:function(){return this._isFullscreen},set:function(value){this._isFullscreen=value},enumerable:!1,configurable:!0}),CanvasWithImage}(fabric.Canvas);fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.cornerColor="white",fabric.Object.prototype.borderColor="white",fabric.Object.prototype.borderScaleFactor=2;var deleteImg=document.createElement("img");deleteImg.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMC4xNjQwNjIiIHk9IjAuMzA1NjY0IiB3aWR0aD0iNDkuMzg4IiBoZWlnaHQ9IjQ5LjM4OCIgcng9IjI0LjY5NCIgZmlsbD0id2hpdGUiLz4KPGcgb3BhY2l0eT0iMC42NSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuNDQ3MSAxOS45OTg1QzE5LjcxMDggMTkuOTk4NSAxOS4yMjcgMTkuMjI5NyAxOS41NDU2IDE4LjU2NThMMjAuOTg1NiAxNS41NjU5QzIxLjE1MiAxNS4yMTkyIDIxLjUwMjUgMTQuOTk4NiAyMS44ODcxIDE0Ljk5ODZIMjcuODI4NUMyOC4yMTMxIDE0Ljk5ODYgMjguNTYzNiAxNS4yMTkyIDI4LjczIDE1LjU2NTlMMzAuMTcgMTguNTY1OEMzMC40ODg2IDE5LjIyOTcgMzAuMDA0OCAxOS45OTg1IDI5LjI2ODUgMTkuOTk4NUgyMC40NDcxWk0yMy4yNTkyIDE3Ljk5ODZDMjIuNjYwMiAxNy45OTg2IDIyLjMwMjkgMTcuMzMxIDIyLjYzNTIgMTYuODMyNkMyMi43NzQzIDE2LjYyMzkgMjMuMDA4NCAxNi40OTg2IDIzLjI1OTIgMTYuNDk4NkgyNi40NTY0QzI2LjcwNzEgMTYuNDk4NiAyNi45NDEzIDE2LjYyMzkgMjcuMDgwNCAxNi44MzI2QzI3LjQxMjcgMTcuMzMxIDI3LjA1NTQgMTcuOTk4NiAyNi40NTY0IDE3Ljk5ODZIMjMuMjU5MloiIGZpbGw9IiM3MDc4OEMiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNy4zNTg0IDMxLjk5NzhDMTcuMzU4NCAzMy42NTQ2IDE4LjcwMTUgMzQuOTk3NyAyMC4zNTgzIDM0Ljk5NzdIMjkuMzU4MUMzMS4wMTUgMzQuOTk3NyAzMi4zNTgxIDMzLjY1NDYgMzIuMzU4MSAzMS45OTc4VjE3Ljk5OEgxNy4zNTg0VjMxLjk5NzhaTTIxLjg1ODQgMjMuOTk4MUMyMS44NTg0IDIzLjQ0NTggMjIuMzA2MSAyMi45OTgxIDIyLjg1ODQgMjIuOTk4MUMyMy40MTA3IDIyLjk5ODEgMjMuODU4NCAyMy40NDU4IDIzLjg1ODQgMjMuOTk4MVYyOC45OThDMjMuODU4NCAyOS41NTAzIDIzLjQxMDcgMjkuOTk4IDIyLjg1ODQgMjkuOTk4QzIyLjMwNjEgMjkuOTk4IDIxLjg1ODQgMjkuNTUwMyAyMS44NTg0IDI4Ljk5OFYyMy45OTgxWk0yNi44NTgxIDIyLjk5ODRDMjYuMzA1OCAyMi45OTg0IDI1Ljg1ODEgMjMuNDQ2MSAyNS44NTgxIDIzLjk5ODNWMjguOTk4MkMyNS44NTgxIDI5LjU1MDUgMjYuMzA1OCAyOS45OTgyIDI2Ljg1ODEgMjkuOTk4MkMyNy40MTA0IDI5Ljk5ODIgMjcuODU4MSAyOS41NTA1IDI3Ljg1ODEgMjguOTk4MlYyMy45OTgzQzI3Ljg1ODEgMjMuNDQ2MSAyNy40MTA0IDIyLjk5ODQgMjYuODU4MSAyMi45OTg0WiIgZmlsbD0iIzcwNzg4QyIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTM0LjM1NzUgMTguOTk4QzM0LjM1NzUgMTkuNTUwMyAzMy45MDk4IDE5Ljk5OCAzMy4zNTc1IDE5Ljk5OEgxNi4zNTc5QzE1LjgwNTYgMTkuOTk4IDE1LjM1NzkgMTkuNTUwMyAxNS4zNTc5IDE4Ljk5OEMxNS4zNTc5IDE4LjQ0NTggMTUuODA1NiAxNy45OTggMTYuMzU3OSAxNy45OThIMzMuMzU3NUMzMy45MDk4IDE3Ljk5OCAzNC4zNTc1IDE4LjQ0NTggMzQuMzU3NSAxOC45OThaIiBmaWxsPSIjNzA3ODhDIi8+CjwvZz4KPC9zdmc+Cg==";var deleteControl=new fabric.Control({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:function(eventData,transform,x,y){var target=transform.target,canvas=target.canvas;canvas.remove(target),canvas.requestRenderAll()},render:function(ctx,left,top,styleOverride,fabricObject){var size=this.cornerSize;ctx.save(),ctx.translate(left,top),ctx.rotate(fabric.util.degreesToRadians(fabricObject.angle)),ctx.drawImage(deleteImg,-size/2,-size/2,size,size),ctx.restore()},cornerSize:24});fabric.Object.prototype.controls.deleteControl=deleteControl,fabric.Textbox.prototype.controls.deleteControl=deleteControl;var CorrectTool=function(_super){function CorrectTool(config){var _this=_super.call(this)||this;return Object.defineProperty(_this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_toolManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_correctId",{enumerable:!0,configurable:!0,writable:!0,value:v4()}),Object.defineProperty(_this,"_isDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_addedObjects",{enumerable:!0,configurable:!0,writable:!0,value:[]}),_this._container=config.container,_this._initializeCanvas(config),_this._addCanvasEventListener(),_this._addObjectListener(),_this._toolManager=new ActionsManager(_this._correctId,_this.canvas),_this}return __extends(CorrectTool,_super),Object.defineProperty(CorrectTool.prototype,"_initializeCanvas",{enumerable:!1,configurable:!0,writable:!0,value:function(config){var canvasEle=this._createCanvasEle(this._container);this.canvas=new CanvasWithImage(canvasEle,{preserveObjectStacking:!0,isDrawingMode:!1,backgroundColor:"#f2f7fe"},this._correctId,config)}}),Object.defineProperty(CorrectTool.prototype,"_addObjectListener",{enumerable:!1,configurable:!0,writable:!0,value:function(){emiter.on("".concat(this._correctId,":").concat(DefinedEvents.CREATE_OBJ),this._onObjectsChange.bind(this,"create")),emiter.on("".concat(this._correctId,":").concat(DefinedEvents.DELETE_OBJ),this._onObjectsChange.bind(this,"delete"))}}),Object.defineProperty(CorrectTool.prototype,"_onObjectsChange",{enumerable:!1,configurable:!0,writable:!0,value:function(type){this.emit("create"===type?DefinedEvents.CREATE_OBJ:DefinedEvents.DELETE_OBJ)}}),Object.defineProperty(CorrectTool.prototype,"_addCanvasEventListener",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.canvas.on("mouse:down",this._onMouseDown.bind(this)),this.canvas.on("mouse:move",this._onMouseMove.bind(this)),this.canvas.on("mouse:up",this._onMouseUp.bind(this))}}),Object.defineProperty(CorrectTool.prototype,"_onMouseDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var _a;this._isDisabled||e.target||null===(_a=this._toolManager.curTool)||void 0===_a||_a.mousedown(e.absolutePointer)}}),Object.defineProperty(CorrectTool.prototype,"_onMouseMove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var _a,_b;this._isDisabled||null===(_b=null===(_a=this._toolManager.curTool)||void 0===_a?void 0:_a.mousemove)||void 0===_b||_b.call(_a,e.absolutePointer)}}),Object.defineProperty(CorrectTool.prototype,"_onMouseUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var _a,_b;this._isDisabled||null===(_b=null===(_a=this._toolManager.curTool)||void 0===_a?void 0:_a.mouseup)||void 0===_b||_b.call(_a,e.absolutePointer)}}),Object.defineProperty(CorrectTool.prototype,"_createCanvasEle",{enumerable:!1,configurable:!0,writable:!0,value:function(container){var canvasEle=document.createElement("canvas"),canvasScrollWrapper=document.createElement("div");return canvasScrollWrapper.style.cssText="overflow: auto;width: 100%;height: 100%;display: flex;justify-content: center;",canvasScrollWrapper.appendChild(canvasEle),container.appendChild(canvasScrollWrapper),canvasEle}}),Object.defineProperty(CorrectTool.prototype,"fullscreen",{enumerable:!1,configurable:!0,writable:!0,value:function(_value){this.canvas.isFullscreen=_value}}),Object.defineProperty(CorrectTool.prototype,"disable",{enumerable:!1,configurable:!0,writable:!0,value:function(_value2){this._isDisabled=_value2,this.canvas.skipTargetFind=_value2,this.canvas.setZoom(1),this.canvas.discardActiveObject().renderAll()}}),Object.defineProperty(CorrectTool.prototype,"reset",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _a;this._addedObjects=[],this.canvas.resetFilpRotate(),this.canvas.discardActiveObject().renderAll(),(_a=this.canvas).remove.apply(_a,this.canvas.getObjects())}}),Object.defineProperty(CorrectTool.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _a;this.canvas.off("mouse:down",this._onMouseDown),this.canvas.off("mouse:move",this._onMouseMove),this.canvas.off("mouse:up",this._onMouseUp),emiter.off("".concat(this._correctId,":").concat(DefinedEvents.CREATE_OBJ),this._onObjectsChange),emiter.off("".concat(this._correctId,":").concat(DefinedEvents.DELETE_OBJ),this._onObjectsChange),null===(_a=this._toolManager)||void 0===_a||_a.destroy(),this.canvas.destroy()}}),Object.defineProperty(CorrectTool.prototype,"isEdited",{get:function(){return this._addedObjects.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(CorrectTool.prototype,"setCurActionTypeInfo",{enumerable:!1,configurable:!0,writable:!0,value:function(actionTypeInfo){this._toolManager.setCurActionType(actionTypeInfo)}}),Object.defineProperty(CorrectTool.prototype,"curActionType",{get:function(){return this._toolManager.curActionType},enumerable:!1,configurable:!0}),Object.defineProperty(CorrectTool.prototype,"correctId",{get:function(){return this._correctId},enumerable:!1,configurable:!0}),Object.defineProperty(CorrectTool,"VERSION",{enumerable:!0,configurable:!0,writable:!0,value:"1.1.14"}),CorrectTool}(EventEmitter);export{Controls,CorrectTool,DefinedEvents,EventEmitter,IconsInCanvas,Zoom$1 as Zoom,iconsLoaded,loadImage,preloadIcon};
